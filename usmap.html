<!DOCTYPE html>
<!-- saved from url=(0039)file:///home/james/Downloads/usmap.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
    <link type="text/css" rel="stylesheet" href="./usmap_files/style.css">
    <style type="text/css">

#states path {
  fill: #ccc;
  stroke: #fff;
}

path.arc {
  pointer-events: none;
  fill: none;
  stroke: #000;
  display: none;
}

path.cell {
  fill: none;
  pointer-events: all;
}

circle {
  fill: steelblue;
  fill-opacity: .8;
  stroke: #fff;
}

td {
  font-size: small;
}

#cells g:hover path.arc {
  display: inherit;
}

    </style>
  </head>
  <body>


  <form onsubmit="javascript:setRanges(this.numranges.value);">
  <table>
    <tr>
    <td id="mapcell">
    </td>
    <td>
      <table>
      <tr>
      <td id="citycell">
      </td>
      </tr>
      <tr>
      <td>
      How many ranges per team?<br>
      <input type="text" id="numranges">
      <button type="button" onclick="setRanges();">Ok</button>
      </td>
      </table>
    </td>
    </tr>
  </table>
  </form>

    <script type="text/javascript" src="./usmap_files/d3.js"></script>
    <script type="text/javascript" src="./usmap_files/d3.csv.js"></script>
    <script type="text/javascript" src="./usmap_files/d3.geo.js"></script>
    <script type="text/javascript" src="./usmap_files/d3.geom.js"></script>
    <script type="text/javascript">

var w = 1280,
    h = 800;

var projection = d3.geo.azimuthal()
    .mode("equidistant")
    .origin([-98, 38])
    .scale(1400)
    .translate([640, 360]);

var path = d3.geo.path()
    .projection(projection);

var svg = d3.select("#mapcell").insert("svg:svg")
    .attr("width", w)
    .attr("height", h);

var states = svg.append("svg:g")
    .attr("id", "states");

var circles = svg.append("svg:g")
    .attr("id", "circles");

var ranges = svg.append("svg:g")
    .attr("id", "ranges");

//var circles = {[]};

var cells = svg.append("svg:g")
    .attr("id", "cells");

d3.json("us-states.json", function(collection) {
  states.selectAll("path")
      .data(collection.features)
    .enter().append("svg:path")
      .attr("d", path);
});

var positions = [];
var locationByAirport = {};
var cities = [];
var numranges = 1;

d3.csv("cities.csv", function(airports) {

//var arc = d3.geo.greatArc()
//  .source(function(d) { return locationByAirport[d.source]; })
//  .target(function(d) { return locationByAirport[d.target]; });

airports = airports.forEach(function(airport) {
  var location = [+airport.longitude, +airport.latitude];
  locationByAirport[airport.iata] = location;
  positions.push(projection(location));
  cities.push(airport.city);
});

});

function start() {

  var g = cells.selectAll("g")
    .data(cities)
    .enter().append("svg:g");

  circles.selectAll("circle")
    .data(cities)
    .enter().append("svg:circle")
    .attr("r", 10)
    .attr("cx", function(d, i) { return positions[i][0]; })
    .attr("cy", function(d, i) { return positions[i][1]; })
    .on("mouseover", function(d, i) { d3.select("#citycell").text(cities[i]); });
 
//  for(r=0; r<numranges; r++) {
    ranges.selectAll("circle")
    .data(cities)
    .enter().append("svg:circle")
    .attr("id", function(d, i) { return ("range" + i); } );
   
    ranges.selectAll("circle")
    .attr("r", 10)
    .attr("cx", function(d, i) { return positions[i][0]; })
    .attr("cy", function(d, i) { return positions[i][1]; })
    .on("mouseover", function(d, i) { d3.select("#range" + i).transition().attr("r", 100 * (0+1)); })
    .on("mouseout", function(d, i) { d3.select("#range" + i).transition().attr("r", 10); });
    
 // }

}

function setRanges() {
  numranges = document.getElementById("numranges").value;
  start();
}

    </script>
  

</body></html>
